<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />

        <link rel="icon" href="/assets/images/icon_round_32.png" />
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter|Roboto">

        <title>[CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 3: L·∫≠p tr√¨nh c√°c t√≠nh nƒÉng | UCC Blog</title>

        <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>[CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 3: L·∫≠p tr√¨nh c√°c t√≠nh nƒÉng | UCC Blog</title>
<meta name="generator" content="Jekyll v4.2.2" />
<meta property="og:title" content="[CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 3: L·∫≠p tr√¨nh c√°c t√≠nh nƒÉng" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="·ªû Ph·∫ßn 2, UCC ƒë√£ c√πng c√°c b·∫°n ƒëƒÉng k√Ω t√†i kho·∫£n Bot v·ªõi Discord v√† ƒëƒÉng nh·∫≠p v√†o n√≥ b·∫±ng Javascript. Trong b√†i vi·∫øt n√†y, m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n l·∫≠p tr√¨nh ƒë·∫ßy ƒë·ªß c√°c t√≠nh nƒÉng ƒë·ªÉ con Bot c·ªßa ch√∫ng ta ch·∫°y ƒë∆∞·ª£c nh·∫°c nh√©!" />
<meta property="og:description" content="·ªû Ph·∫ßn 2, UCC ƒë√£ c√πng c√°c b·∫°n ƒëƒÉng k√Ω t√†i kho·∫£n Bot v·ªõi Discord v√† ƒëƒÉng nh·∫≠p v√†o n√≥ b·∫±ng Javascript. Trong b√†i vi·∫øt n√†y, m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n l·∫≠p tr√¨nh ƒë·∫ßy ƒë·ªß c√°c t√≠nh nƒÉng ƒë·ªÉ con Bot c·ªßa ch√∫ng ta ch·∫°y ƒë∆∞·ª£c nh·∫°c nh√©!" />
<link rel="canonical" href="https://usth-coders-club.github.io/discord-music-bot-3/" />
<meta property="og:url" content="https://usth-coders-club.github.io/discord-music-bot-3/" />
<meta property="og:site_name" content="UCC Blog" />
<meta property="og:image" content="https://usth-coders-club.github.io/assets/images/posts/2022-05-06-discord-music-bot-3/banner.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2022-05-06T00:00:00+00:00" />
<meta name="twitter:card" content="summary_large_image" />
<meta property="twitter:image" content="https://usth-coders-club.github.io/assets/images/posts/2022-05-06-discord-music-bot-3/banner.jpg" />
<meta property="twitter:title" content="[CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 3: L·∫≠p tr√¨nh c√°c t√≠nh nƒÉng" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-05-06T00:00:00+00:00","datePublished":"2022-05-06T00:00:00+00:00","description":"·ªû Ph·∫ßn 2, UCC ƒë√£ c√πng c√°c b·∫°n ƒëƒÉng k√Ω t√†i kho·∫£n Bot v·ªõi Discord v√† ƒëƒÉng nh·∫≠p v√†o n√≥ b·∫±ng Javascript. Trong b√†i vi·∫øt n√†y, m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n l·∫≠p tr√¨nh ƒë·∫ßy ƒë·ªß c√°c t√≠nh nƒÉng ƒë·ªÉ con Bot c·ªßa ch√∫ng ta ch·∫°y ƒë∆∞·ª£c nh·∫°c nh√©!","headline":"[CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 3: L·∫≠p tr√¨nh c√°c t√≠nh nƒÉng","image":"https://usth-coders-club.github.io/assets/images/posts/2022-05-06-discord-music-bot-3/banner.jpg","mainEntityOfPage":{"@type":"WebPage","@id":"https://usth-coders-club.github.io/discord-music-bot-3/"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://usth-coders-club.github.io/assets/images/logo_fixed.png"}},"url":"https://usth-coders-club.github.io/discord-music-bot-3/"}</script>
<!-- End Jekyll SEO tag -->


        <link
            rel="stylesheet"
            href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
            integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
            crossorigin="anonymous"
        />

        <link href="/assets/css/screen.css" rel="stylesheet" />

        <link href="/assets/css/main.css" rel="stylesheet" />
    
        <script src="/assets/js/jquery.min.js"></script>
   
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-36DEMQV4QJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-36DEMQV4QJ');
</script>
   
<!--     <script>
        (function (i, s, o, g, r, a, m) {
            i["GoogleAnalyticsObject"] = r;
            (i[r] =
                i[r] ||
                function () {
                    (i[r].q = i[r].q || []).push(arguments);
                }),
                (i[r].l = 1 * new Date());
            (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
            a.async = 1;
            a.src = g;
            m.parentNode.insertBefore(a, m);
        })(window, document, "script", "//www.google-analytics.com/analytics.js", "ga");
        ga("create", "G-36DEMQV4QJ", "auto");
        ga("send", "pageview");
    </script> -->
         </head>
     
    <body class="layout-post">
        <!-- defer loading of font and font awesome -->
        <noscript id="deferred-styles">
            <link
                href="https://fonts.googleapis.com/css?family=Righteous%7CMerriweather:300,300i,400,400i,700,700i"
                rel="stylesheet"
            />
            <link
                rel="stylesheet"
                href="https://use.fontawesome.com/releases/v5.0.13/css/all.css"
                integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp"
                crossorigin="anonymous"
            />
        </noscript>

        <!-- Begin Menu Navigation
================================================== -->
        <nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top mediumnavigation nav-down">
            <div class="container pr-0">
                <!-- Begin Logo -->
                <a class="navbar-brand" href="/">
                    <img src="/assets/images/logo_fixed.png" height="50" alt="USTH Coders Club Blog"/>
                </a>
                <!-- End Logo -->

                <button
                    class="navbar-toggler"
                    type="button"
                    data-toggle="collapse"
                    data-target="#navbarMediumish"
                    aria-controls="navbarSupportedContent"
                    aria-expanded="false"
                    aria-label="Toggle navigation"
                >
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarMediumish">
                    <!-- Begin Menu -->

                    <ul class="navbar-nav ml-auto">
                        </li>

                        <li class="nav-item">
                            
                            <a class="nav-link" href="/index.html">Blog</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/categories">Categories</a>
                        </li>

                        <li class="nav-item">
                            <a class="nav-link" href="/about">About</a>
                        </li>

                        <script src="/assets/js/lunr.js"></script>


<style>
    .lunrsearchresult .title {color: #d9230f;}
    .lunrsearchresult .url {color: silver;}
    .lunrsearchresult a {display: block; color: #777;}
    .lunrsearchresult a:hover, .lunrsearchresult a:focus {text-decoration: none;}
    .lunrsearchresult a:hover .title {text-decoration: underline;}
</style>


<form class="bd-search" onSubmit="return lunr_search(document.getElementById('lunrsearch').value);">
    <input type="text" class="form-control text-small launch-modal-search" id="lunrsearch" name="q" maxlength="255" value="" placeholder="Type and enter..."/>
</form>

<div id="lunrsearchresults">
    <ul></ul>
</div>

<script src="/assets/js/lunrsearchengine.js"></script>
                    </ul>

                    <!-- End Menu -->
                </div>
            </div>
        </nav>
        <!-- End Navigation
================================================== -->

        <div class="site-content">
            <div class="container">
                <!-- Site Title
================================================== -->
                <div class="mainheading">
                    <h1 class="sitetitle">USTH Coders Club Blog</h1>
                    <p class="lead">Chia s·∫ª v·ªÅ l·∫≠p tr√¨nh</p>
                </div>

                <!-- Content
================================================== -->
                <div class="main-content"><!-- Begin Article
================================================== -->
<div class="container">
    <div class="row">

        <!-- Post Share -->
        <div class="col-md-2 pl-0">
            <div class="share sticky-top sticky-top-offset">
    <p>
        Share
    </p>
    <ul>
        <li class="ml-1 mr-1">
            <a target="_blank" href="https://twitter.com/intent/tweet?text=[CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 3: L·∫≠p tr√¨nh c√°c t√≠nh nƒÉng&url=https://usth-coders-club.github.io/discord-music-bot-3/" onclick="window.open(this.href, 'twitter-share', 'width=550,height=435');return false;">
                <i class="fab fa-twitter"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://facebook.com/sharer.php?u=https://usth-coders-club.github.io/discord-music-bot-3/" onclick="window.open(this.href, 'facebook-share', 'width=550,height=435');return false;">
                <i class="fab fa-facebook-f"></i>
            </a>
        </li>

        <li class="ml-1 mr-1">
            <a target="_blank" href="https://www.linkedin.com/shareArticle?mini=true&url=https://usth-coders-club.github.io/discord-music-bot-3/" onclick="window.open(this.href, 'linkedin-share','width=550,height=435');return false;">
                <i class="fab fa-linkedin-in"></i>
            </a>
        </li>

    </ul>
    
    <div class="sep">
    </div>
    <ul>
        <li>
        <a class="small smoothscroll" href="#disqus_thread"></a>
        </li>
    </ul>
    
</div>

        </div>

        <!-- Post -->
        

        <div class="col-md-9 flex-first flex-md-unordered">
            <div class="mainheading">

                <!-- Author Box -->
                
                    
                        
                        <div class="row post-top-meta">
                            <div class="col-xs-12 col-md-3 col-lg-2 text-center text-md-left mb-4 mb-md-0">
                                
                                <img class="author-thumb" src="/assets/images/avatar/picklerick.jpg" alt="ƒê·ªó Nh·∫≠t Th√†nh">
                                
                            </div>
                            <div class="col-xs-12 col-md-9 col-lg-10 text-center text-md-left">
                                <a target="_blank" class="link-dark" href="https://thanlanslab.wordpress.com/">ƒê·ªó Nh·∫≠t Th√†nh</a><a target="_blank" href="" class="btn follow">Follow</a>
                                <div class="author-description text-secondary">UCC Gen2 RnD member.</div>
                            </div>
                        </div>
                    
                

                <!-- Post Title -->
                <h1 class="posttitle">[CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 3: L·∫≠p tr√¨nh c√°c t√≠nh nƒÉng</h1>

            </div>

            <!-- Adsense if enabled from _config.yml (change your pub id and slot) -->
            
            <!-- End Adsense -->

            <!-- Post Featured Image -->
            

            
            <img class="featured-image img-fluid" src="/assets/images/posts/2022-05-06-discord-music-bot-3/banner.jpg" alt="[CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 3: L·∫≠p tr√¨nh c√°c t√≠nh nƒÉng">
            

            
            <!-- End Featured Image -->

            <!-- Post Content -->
            <div class="article-post">
                <!-- Toc if any -->
                
                    
                    <div class="toc mt-4 mb-4 lead">
                        <div class="divinline">
                        <h3 class="font-weight-bold">Summary </h3>
                        <a id='btntoc' onclick="tocbtn()">Hide</a>
                        </div>
                        <ul id="my_toc" class="inline_toc">
  <li class="tocp"><a href="#c·∫•u-tr√∫c-ho·∫°t-ƒë·ªông-c·ªßa-bot">C·∫•u tr√∫c ho·∫°t ƒë·ªông c·ªßa Bot</a></li>
  <li class="tocp"><a href="#handlersjs">handlers.js</a></li>
  <li class="tocp"><a href="#playjs">play.js</a></li>
  <li class="tocp"><a href="#pausejs">pause.js</a></li>
  <li class="tocp"><a href="#resumejs">resume.js</a></li>
  <li class="tocp"><a href="#skipjs">skip.js</a></li>
  <li class="tocp"><a href="#backjs">back.js</a></li>
  <li class="tocp"><a href="#stopjs">stop.js</a></li>
  <li class="tocp"><a href="#nowplayingjs">nowplaying.js</a></li>
  <li class="tocp"><a href="#queuejs">queue.js</a></li>
  <li class="tocp"><a href="#t·ªïng-k·∫øt">T·ªïng k·∫øt</a></li>
</ul>
                    </div>
                
                <!-- End Toc -->
                <p>·ªû Ph·∫ßn 2, UCC ƒë√£ c√πng c√°c b·∫°n ƒëƒÉng k√Ω t√†i kho·∫£n Bot v·ªõi Discord v√† ƒëƒÉng nh·∫≠p v√†o n√≥ b·∫±ng Javascript. Trong b√†i vi·∫øt n√†y, m√¨nh s·∫Ω h∆∞·ªõng d·∫´n c√°c b·∫°n l·∫≠p tr√¨nh ƒë·∫ßy ƒë·ªß c√°c t√≠nh nƒÉng ƒë·ªÉ con Bot c·ªßa ch√∫ng ta ch·∫°y ƒë∆∞·ª£c nh·∫°c nh√©!</p>

<h2 id="c·∫•u-tr√∫c-ho·∫°t-ƒë·ªông-c·ªßa-bot">C·∫•u tr√∫c ho·∫°t ƒë·ªông c·ªßa Bot</h2>

<p>Con Bot c·ªßa ch√∫ng ta s·∫Ω c√≥ nh·ªØng l·ªánh c∆° b·∫£n c·ªßa m·ªôt Bot ch∆°i nh·∫°c:</p>

<ul>
  <li><strong>play</strong>: Ch∆°i m·ªôt b√†i nh·∫°c</li>
  <li><strong>pause</strong>: T·∫°m d·ª´ng nh·∫°c</li>
  <li><strong>resume</strong>: Ti·∫øp t·ª•c ch∆°i nh·∫°c</li>
  <li><strong>back</strong>: Quay v·ªÅ b√†i tr∆∞·ªõc</li>
  <li><strong>skip</strong>: B·ªè qua b√†i nh·∫°c ƒëang ch∆°i</li>
  <li><strong>nowplaying</strong>: Th√¥ng tin v·ªÅ b√†i nh·∫°c ƒëang ƒë∆∞·ª£c ch∆°i</li>
  <li><strong>queue</strong>: Danh s√°ch c√°c b√†i nh·∫°c ƒë√£ ƒë∆∞·ª£c ƒëƒÉng k√Ω</li>
  <li><strong>stop</strong>: D·ª´ng ch∆°i nh·∫°c</li>
</ul>

<p>V·ªõi r·∫•t nhi·ªÅu l·ªánh nh∆∞ v·∫≠y, ch√∫ng ta c·∫ßn m·ªôt ‚Äútrung t√¢m ƒëi·ªÅu khi·ªÉn‚Äù ƒë·ªÉ c√≥ th·ªÉ x·ª≠ l√Ω. M√¨nh s·∫Ω g·ªçi file n√†y l√† <strong>handler.js</strong>. Nhi·ªám v·ª• c·ªßa file n√†y l√† ph√°t hi·ªán khi ng∆∞·ªùi d√πng mu·ªën ra l·ªánh n√†o ƒë√≥ cho Bot, sau ƒë√≥ x·ª≠ l√Ω tin nh·∫Øn h·ªç g·ª≠i ƒë·∫øn r·ªìi ch·∫°y l·ªánh t∆∞∆°ng ·ª©ng. Con Bot c·ªßa ch√∫ng ta s·∫Ω ho·∫°t ƒë·ªông theo m√¥ h√¨nh nh∆∞ sau:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled_Diagram.drawio.png" alt="Untitled_Diagram.drawio" /></p>

<p>Object <strong>message</strong> ƒë∆∞·ª£c Discord tr·∫£ v·ªÅ khi k√≠ch ho·∫°t event ‚Äú<strong>messageCreate</strong>‚Äù s·∫Ω ƒë∆∞·ª£c truy·ªÅn v√†o file <strong>handler.js</strong>. T·∫°i ƒë√¢y, ch√∫ng ta s·∫Ω ph√¢n bi·ªát xem tin nh·∫Øn ƒë∆∞·ª£c g·ª≠i ƒë·∫øn c√≥ ph·∫£i m·ªôt l·ªánh h·ª£p l·ªá hay kh√¥ng, sau ƒë√≥ chuy·ªÉn t√°ch t√™n l·ªánh v√† argument r·ªìi truy·ªÅn xu·ªëng file t√≠nh nƒÉng t∆∞∆°ng ·ª©ng ƒë·ªÉ x·ª≠ l√Ω. V√≠ d·ª• cho d·ªÖ hi·ªÉu, gi·∫£ s·ª≠ b·∫°n g·ª≠i m·ªôt tin nh·∫Øn c√≥ n·ªôi dung ‚Äú<strong>!play L√¢u ƒë√†i t√¨nh √°i</strong>‚Äù, handler.js s·∫Ω nh·∫≠n ra tin nh·∫Øn n√†y b·∫Øt ƒë·∫ßu b·∫±ng d·∫•u ‚Äú<strong>!</strong>‚Äù (<strong>PREFIX</strong>) b√°o hi·ªáu cho bot chu·∫©n b·ªã x·ª≠ l√Ω, sau ƒë√≥ file n√†y s·∫Ω t√°ch tin nh·∫Øn ra l√†m hai ph·∫ßn: ph·∫ßn command l√† ‚Äú<strong>play</strong>‚Äù v√† ph·∫ßn argument l√† ‚Äú<strong>L√¢u ƒë√†i t√¨nh √°i</strong>‚Äù, r·ªìi n√≥ s·∫Ω truy·ªÅn argument n√†y v√†o file <strong>play.js.</strong></p>

<p>Do v·∫≠y <strong>PREFIX</strong> kh√° quan tr·ªçng. N√≥ gi√∫p con Bot c·ªßa ch√∫ng ta ph√¢n bi·ªát nh·ªØng tin nh·∫Øn c·∫ßn x·ª≠ l√Ω v√† nh·ªØng tin nh·∫Øn n√†o kh√¥ng. C√°c b·∫°n h√£y th√™m m·ªôt d√≤ng khai b√°o <strong>PREFIX</strong> v√†o file <strong>.env</strong> nh√©. ·ªû ƒë√¢y m√¨nh d√πng d·∫•u ch·∫•m than <strong>!</strong>, c√°c b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng d·∫•u g√¨ c≈©ng ƒë∆∞·ª£c:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled.png" alt="Untitled.png" /></p>

<h2 id="handlersjs">handlers.js</h2>

<p>Nh∆∞ ƒë√£ ƒë·ªÅ c·∫≠p, file n√†y s·∫Ω x·ª≠ l√Ω tin nh·∫Øn ƒë·∫ßu v√†o t·ª´ ng∆∞·ªùi d√πng g·ª≠i ƒë·∫øn server. C√°c b·∫°n h√£y t·∫°o m·ªôt folder l√† <strong>handler</strong> v√† cho v√†o ƒë√≥ m·ªôt file <strong>handler.js</strong> nh√©:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 1.png" alt="Untitled 1.png" /></p>

<p>·ªû ƒë√¢y ch√∫ng ta s·∫Ω c·∫ßn ƒë·∫øn bi·∫øn <strong>PREFIX</strong> ·ªü file .env, n√™n c√°c b·∫°n h√£y khai b√°o s·ª≠ d·ª•ng module <strong>dotenv</strong> nh√©:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>V√¨ ch√∫ng ta s·∫Ω c·∫ßn s·ª≠ d·ª•ng file <strong>handler.js</strong> n√†y ·ªü <strong>index.js</strong>, n√™n c√°c b·∫°n h√£y s·ª≠ d·ª•ng <strong>module.exports</strong> ƒë·ªÉ xu·∫•t h√†m x·ª≠ l√Ω ra ngo√†i:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">async</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ch√∫ng ta s·∫Ω xu·∫•t ra ngo√†i h√†m <strong>handle()</strong> ch·ª©a c√°c tham s·ªë bao g·ªìm object <strong>client</strong>, <strong>message</strong> v√† <strong>player</strong>.</p>

<p>Okay. Vi·ªác ƒë·∫ßu ti√™n ch√∫ng ta c·∫ßn l√†m l√† ki·ªÉm tra xem tin nh·∫Øn c·ªßa ng∆∞·ªùi g·ª≠i c√≥ b·∫Øt ƒë·∫ßu b·∫±ng <strong>PREFIX</strong> hay kh√¥ng. B√™n c·∫°nh ƒë√≥ ta c≈©ng kh√¥ng mu·ªën x·ª≠ l√Ω nh·ªØng tin nh·∫Øn m√† ch√≠nh con Bot c·ªßa m√¨nh g·ª≠i ƒë·∫øn server:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">raw_message</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">raw_message</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PREFIX</span><span class="p">)</span> <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">bot</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>N·∫øu tin nh·∫Øn ƒë∆∞·ª£c g·ª≠i ƒë·∫øn v·ª´a b·∫Øt ƒë·∫ßu v·ªõi PREFIX l·∫°i v·ª´a kh√¥ng ph·∫£i t·ª´ Bot, ch√∫ng ta s·∫Ω x·ª≠ l√Ω ti·∫øp. B∆∞·ªõc ti·∫øp theo ta s·∫Ω t√°ch t√™n <strong>command</strong> v√† <strong>argument</strong>.</p>

<p>V√¨ ph·∫ßn <strong>command</strong> v√† <strong>argument</strong> ƒë∆∞·ª£c ph√¢n c√°ch nhau b·ªüi d·∫•u c√°ch, ch√∫ng ta c√≥ th·ªÉ s·ª≠ d·ª•ng h√†m <code class="language-plaintext highlighter-rouge">split(‚Äù ‚Äú)</code> , sau ƒë√≥ l∆∞·ª£c b·ªè ph·∫ßn PREFIX ƒëi:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">command</span> <span class="o">=</span> <span class="nx">raw_message</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">substring</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ph·∫ßn c√≤n l·∫°i c·ªßa tin nh·∫Øn s·∫Ω l√† <strong>argument</strong>. Ch√∫ng ta s·∫Ω mu·ªën n√≥ l√† m·ªôt string duy nh·∫•t n√™n s·∫Ω s·ª≠ d·ª•ng h√†m <strong>join()</strong>:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">raw_message</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ch√∫ng ta th√™m hai d√≤ng ƒë·ªÉ ki·ªÉm tra xem <strong>command</strong> v√† <strong>argument</strong> ƒë√£ ƒë∆∞·ª£c t√°ch th√†nh c√¥ng ch∆∞a nh√©:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Command: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">command</span><span class="p">);</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Argument: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">args</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">dotenv</span><span class="dl">'</span><span class="p">).</span><span class="nx">config</span><span class="p">();</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="k">async</span> <span class="nx">handle</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">raw_message</span> <span class="o">=</span> <span class="nx">message</span><span class="p">.</span><span class="nx">content</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">raw_message</span><span class="p">.</span><span class="nx">startsWith</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PREFIX</span><span class="p">)</span> <span class="o">||</span> <span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">bot</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">command</span> <span class="o">=</span> <span class="nx">raw_message</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">substring</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PREFIX</span><span class="p">.</span><span class="nx">length</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">args</span> <span class="o">=</span> <span class="nx">raw_message</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="dl">"</span><span class="s2"> </span><span class="dl">"</span><span class="p">);</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Command: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">command</span><span class="p">);</span>
        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="dl">"</span><span class="s2">Argument: </span><span class="dl">"</span> <span class="o">+</span> <span class="nx">args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Tr∆∞·ªõc ti√™n ch√∫ng ta c·∫ßn k·∫øt n·ªëi file <strong>handler.js</strong> n√†y v·ªõi <strong>index.js</strong> ƒë√£. ·ªû <strong>index.js</strong>, ch√∫ng ta c·∫ßn n·∫°p file <strong>handler.js</strong> v√†o m·ªôt bi·∫øn:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">Handler</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">./handler/handler.js</span><span class="dl">'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>·ªû h√†m x·ª≠ l√Ω event ‚Äú<strong>messageCreate</strong>‚Äù, ch√∫ng ta s·∫Ω truy·ªÅn object <strong>message</strong> v√†o <strong>Handler</strong>:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="nx">client</span><span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="dl">'</span><span class="s1">messageCreate</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">message</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">Handler</span><span class="p">.</span><span class="nx">handle</span><span class="p">(</span><span class="nx">client</span><span class="p">,</span> <span class="nx">message</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 2.png" alt="Untitled 2.png" /></p>

<p>Sau ƒë√≥ ch√∫ng ta b·∫•m ch·∫°y <strong>index.js</strong> th√¥i:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 3.png" alt="Untitled 3.png" /></p>

<p>B√¢y gi·ªù h√£y g·ª≠i th·ª≠ tin nh·∫Øn ‚Äú<strong>!play L√¢u ƒë√†i t√¨nh √°i</strong>‚Äù l√™n server:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 4.png" alt="Untitled 4.png" /></p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 5.png" alt="Untitled 5.png" /></p>

<p>Tu·ªµt! V·∫≠y l√† <strong>command</strong> v√† <strong>argument</strong> ƒë√£ ƒë∆∞∆°c t√°ch th√†nh c√¥ng.</p>

<h2 id="playjs">play.js</h2>

<p>Ch√∫ng ta ƒë√£ ho√†n th√†nh ch·ª©c nƒÉng ƒë·∫ßu ti√™n c·ªßa file <strong>handler.js</strong>. Vi·ªác ti·∫øp theo l√† truy·ªÅn <strong>argument</strong> v√†o c√°c file ch·ª©c nƒÉng t∆∞∆°ng ·ª©ng. ƒê·∫ßu ti√™n ch√∫ng ta s·∫Ω l·∫≠p tr√¨nh file <strong>play.js</strong> c√≥ ch·ª©c nƒÉng nh·∫£y v√†o k√™nh voice c·ªßa ng∆∞·ªùi d√πng v√† ch∆°i b√†i nh·∫°c ƒë∆∞·ª£c y√™u c·∫ßu, n·∫øu Bot ƒëang ch∆°i m·ªôt b√†i r·ªìi, n√≥ s·∫Ω cho b√†i m·ªõi y√™u c·∫ßu v√†o <strong>queue</strong>.</p>

<p>ƒê·∫ßu ti√™n b·∫°n h√£y t·∫°o m·ªôt folder <strong>commands</strong> ƒë·ªÉ l∆∞u c√°c file l·ªánh, sau ƒë√≥ t·∫°o file <strong>play.js</strong> ·ªü trong ƒë√≥ nh√©:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 6.png" alt="Untitled 6.png" /></p>

<p>ƒê·∫ßu ti√™n khai b√°o m·ªôt s·ªë <strong>module</strong> s·∫Ω s·ª≠ d·ª•ng:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">MessageEmbed</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">QueryType</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord-player</span><span class="dl">'</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ch√∫ng ta s·∫Ω l·∫°i s·ª≠ d·ª•ng <strong>module.exports</strong> ƒë·ªÉ xu·∫•t h√†m x·ª≠ l√Ω ra ngo√†i:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">play</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">play a song</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">args</span><span class="p">){</span>
        
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ch√∫ng ta s·∫Ω l·∫•y th√¥ng tin v·ªÅ server v√† t√°c gi·∫£ tin nh·∫Øn:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">guild</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">guilds</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">guild</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ta ki·ªÉm tra xem t√°c gi·∫£ c√≥ ·ªü trong k√™nh voice n√†o kh√¥ng:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">author</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channelId</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">you are not in a voice channel.</span><span class="dl">'</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>T·∫°o m·ªôt queue m·ªõi:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">createQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">metadata</span><span class="p">:</span> <span class="p">{</span>
        <span class="na">channel</span><span class="p">:</span> <span class="nx">message</span>
    <span class="p">}</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau ƒë√≥ ta cho bot k·∫øt n·ªëi v√†o k√™nh voice, n·∫øu c√≥ v·∫•n ƒë·ªÅ g√¨ s·∫Ω b√°o l·ªói:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span><span class="p">)</span> <span class="k">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">author</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channelId</span><span class="p">);</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
    <span class="nx">queue</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">could not join your voice channel!</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>N·∫øu k·∫øt n·ªëi th√†nh c√¥ng, ch√∫ng ta s·∫Ω t·∫°o m·ªôt track m·ªõi:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">track</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">player</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="p">{</span>
    <span class="na">requestedBy</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
    <span class="na">searchEngine</span><span class="p">:</span> <span class="nx">QueryType</span><span class="p">.</span><span class="nx">AUTO</span><span class="p">,</span>
<span class="p">});</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">track</span> <span class="o">||</span> <span class="o">!</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">content</span><span class="p">:</span> <span class="s2">`no video/song/playlist was found while searching for: </span><span class="p">${</span><span class="nx">track</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
        <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ƒêo·∫°n code tr√™n s·∫Ω t√¨m ki·∫øm b√†i nh·∫°c theo t√™n ƒë√£ nh·∫≠p. Ta kh·ªüi t·∫°o m·ªôt tin nh·∫Øn Discord Embed ƒë·ªÉ th√¥ng tin v·ªÅ b√†i nh·∫°c v·ª´a t√¨m ƒë∆∞·ª£c:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">playEmbed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageEmbed</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">setColor</span><span class="p">(</span><span class="s2">`RANDOM`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span>
        <span class="s2">`üé∂ | new </span><span class="p">${</span><span class="nx">track</span><span class="p">.</span><span class="nx">playlist</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">playlist</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">song</span><span class="dl">'</span><span class="p">}</span><span class="s2"> added to queue`</span>
    <span class="p">);</span>

<span class="c1">// create embed with thumbnail and description for single tracks</span>
<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">track</span><span class="p">.</span><span class="nx">playlist</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">tr</span> <span class="o">=</span> <span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="nx">playEmbed</span><span class="p">.</span><span class="nx">setThumbnail</span><span class="p">(</span><span class="nx">tr</span><span class="p">.</span><span class="nx">thumbnail</span><span class="p">);</span>
    <span class="nx">playEmbed</span><span class="p">.</span><span class="nx">setDescription</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">tr</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Xong xu√¥i r·ªìi ch√∫ng ta s·∫Ω cho con Bot b·∫≠t b√†i nh·∫°c n√†y l√™n, n·∫øu c√≥ m·ªôt b√†i n√†o ƒë√≥ ƒëang ƒë∆∞·ª£c b·∫≠t th√¨ bot s·∫Ω cho b√†i m·ªõi v√†o queue:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">track</span><span class="p">.</span><span class="nx">playlist</span>
        <span class="p">?</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">addTracks</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">)</span>
        <span class="p">:</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="p">[</span><span class="nx">playEmbed</span><span class="p">]</span> <span class="p">});</span>
<span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">track</span><span class="p">.</span><span class="nx">playlist</span>
        <span class="p">?</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">addTracks</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">)</span>
        <span class="p">:</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">addTrack</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="p">[</span><span class="nx">playEmbed</span><span class="p">]</span> <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Oke, v·∫≠y l√† ch√∫ng ta ƒë√£ l·∫≠p tr√¨nh xong file <strong>play.js</strong> r·ªìi ƒë·∫•y:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
</pre></td><td class="rouge-code"><pre><span class="c1">// necessary classes</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">MessageEmbed</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="p">{</span> <span class="nx">QueryType</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord-player</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">play</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">play a song.</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// get ids of server and person the message was sent from</span>
        <span class="kd">const</span> <span class="nx">guild</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">guilds</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">guild</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">author</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channelId</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">you are not in a voice channel.</span><span class="dl">'</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="c1">// create a queue for given server</span>
        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">createQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">metadata</span><span class="p">:</span> <span class="p">{</span>
                <span class="na">channel</span><span class="p">:</span> <span class="nx">message</span>
            <span class="p">}</span>
        <span class="p">});</span>

        <span class="c1">// check for voice channel connection</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">connection</span><span class="p">)</span> <span class="k">await</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">connect</span><span class="p">(</span><span class="nx">author</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channelId</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">{</span>
            <span class="nx">queue</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">could not join your voice channel!</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="c1">// search for track with given query</span>
        <span class="kd">const</span> <span class="nx">track</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">player</span><span class="p">.</span><span class="nx">search</span><span class="p">(</span><span class="nx">args</span><span class="p">,</span> <span class="p">{</span>
            <span class="na">requestedBy</span><span class="p">:</span> <span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">username</span><span class="p">,</span>
            <span class="na">searchEngine</span><span class="p">:</span> <span class="nx">QueryType</span><span class="p">.</span><span class="nx">AUTO</span><span class="p">,</span>
        <span class="p">});</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">track</span> <span class="o">||</span> <span class="o">!</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="s2">`no video/song/playlist was found while searching for: </span><span class="p">${</span><span class="nx">track</span><span class="p">}</span><span class="s2">`</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="p">});</span>

        <span class="c1">// create embed message</span>
        <span class="kd">const</span> <span class="nx">playEmbed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageEmbed</span><span class="p">()</span>
            <span class="p">.</span><span class="nx">setColor</span><span class="p">(</span><span class="s2">`RANDOM`</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span>
                <span class="s2">`üé∂ | new </span><span class="p">${</span><span class="nx">track</span><span class="p">.</span><span class="nx">playlist</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">playlist</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">song</span><span class="dl">'</span><span class="p">}</span><span class="s2"> added to queue`</span>
            <span class="p">);</span>

        <span class="c1">// create embed with thumbnail and description for single tracks</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">track</span><span class="p">.</span><span class="nx">playlist</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">tr</span> <span class="o">=</span> <span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="nx">playEmbed</span><span class="p">.</span><span class="nx">setThumbnail</span><span class="p">(</span><span class="nx">tr</span><span class="p">.</span><span class="nx">thumbnail</span><span class="p">);</span>
            <span class="nx">playEmbed</span><span class="p">.</span><span class="nx">setDescription</span><span class="p">(</span><span class="s2">`</span><span class="p">${</span><span class="nx">tr</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">`</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="c1">// if queue isn't playing, add tracks to queue and play them</span>
        <span class="c1">// if queue is playing, add tracks to queue</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">track</span><span class="p">.</span><span class="nx">playlist</span>
                <span class="p">?</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">addTracks</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">)</span>
                <span class="p">:</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">play</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="p">[</span><span class="nx">playEmbed</span><span class="p">]</span> <span class="p">});</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">track</span><span class="p">.</span><span class="nx">playlist</span>
                <span class="p">?</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">addTracks</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">)</span>
                <span class="p">:</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">addTrack</span><span class="p">(</span><span class="nx">track</span><span class="p">.</span><span class="nx">tracks</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="p">[</span><span class="nx">playEmbed</span><span class="p">]</span> <span class="p">});</span>
        <span class="p">}</span>

        <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">queue</span><span class="p">.</span><span class="nx">tracks</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ch√∫ng ta quay l·∫°i file <strong>handler.js</strong> ƒë·ªÉ k·∫øt n·ªëi <strong>play.js</strong>. C√°c b·∫°n th√™m m·ªôt h√†m x·ª≠ l√Ω n·∫øu t√™n command ng∆∞·ªùi d√πng nh·∫≠p l√† ‚Äú<strong>play</strong>‚Äù:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">command</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">play</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Play</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../commands/play</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">Play</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">,</span> <span class="nx">args</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 7.png" alt="Untitled 7.png" /></p>

<p>C√≥ v·∫ª ·ªïn r·ªìi ƒë√≥. C√°c b·∫°n h√£y ch·∫°y file <strong>index.js</strong> v√† v√†o server test th·ª≠ nh√©:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 8.png" alt="Untitled 8.png" /></p>

<table>
  <tbody>
    <tr>
      <td>R·∫•t r√µ v√† m∆∞·ª£t „ÉΩ</td>
      <td>ÔΩ•œâÔΩ•</td>
      <td>„Çû</td>
    </tr>
  </tbody>
</table>

<h2 id="pausejs">pause.js</h2>

<p>Sau khi ƒë√£ l·∫≠p tr√¨nh t√≠nh nƒÉng ch∆°i nh·∫°c, ch√∫ng ta c·∫ßn ch·ª©c nƒÉng t·∫°m d·ª´ng. C√°c b·∫°n h√£y t·∫°o m·ªôt file c√≥ t√™n <strong>pause.js</strong> trong th∆∞ m·ª•c <strong>commands</strong> nha:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 9.png" alt="Untitled 9.png" /></p>

<p>Ch√∫ng ta c≈©ng s·∫Ω c·∫ßn th√¥ng tin v·ªÅ server v√† t√°c gi·∫£ tin nh·∫Øn, v√† ki·ªÉm tra xem ng∆∞·ªùi ƒë√≥ c√≥ ·ªü trong k√™nh voice kh√¥ng:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pause</span><span class="dl">'</span><span class="p">,</span> 
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pauses the currently playing song.</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">guild</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">guilds</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">guild</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">author</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channelId</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">you are not in a voice channel.</span><span class="dl">'</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ti·∫øp ƒë√≥ ch√∫ng ta l·∫•y th√¥ng tin v·ªÅ queue nh·∫°c hi·ªán t·∫°i:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>N·∫øu kh√¥ng c√≥ b√†i n√†o ƒëang ƒë∆∞·ª£c ch∆°i, ch√∫ng ta cho Bot th√¥ng b√°o:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | there is no music playing in this server.</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>C√≤n n·∫øu c√≥, ch√∫ng ta s·ª≠ d·ª•ng h√†m <strong>setPaused()</strong> ƒë·ªÉ d·ª´ng:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">setPaused</span><span class="p">({</span> <span class="na">paused</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">content</span><span class="p">:</span> <span class="nx">y</span> <span class="p">?</span> <span class="s2">`‚è∏ | paused.`</span> <span class="p">:</span> <span class="s2">`:x: | failed to pause`</span><span class="p">,</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>ƒê∆°n gi·∫£n v·∫≠y th√¥i!</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pause</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">pauses the currently playing song.</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">guild</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">guilds</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">guild</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">author</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channelId</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">you are not in a voice channel.</span><span class="dl">'</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | there is no music playing in this server.</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">setPaused</span><span class="p">({</span> <span class="na">paused</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="nx">y</span> <span class="p">?</span> <span class="s2">`‚è∏ | paused.`</span> <span class="p">:</span> <span class="s2">`:x: | failed to pause`</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ch√∫ng ta quay l·∫°i file <strong>handler.js</strong> v√† k·∫øt n·ªëi file n√†y nh√©:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">command</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">pause</span><span class="dl">"</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Pause</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../commands/pause</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">Pause</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="resumejs">resume.js</h2>

<p>ƒêi k√®m v·ªõi ch·ª©c nƒÉng t·∫°m d·ª´ng nh·∫°c, ch√∫ng ta c≈©ng c·∫ßn c√≥ ch·ª©c nƒÉng ti·∫øp t·ª•c ph·∫£i kh√¥ng? C√°c b·∫°n h√£y t·∫°o th√™m file resume.js v√†o th∆∞ m·ª•c commands nha. Code c·ªßa file n√†y s·∫Ω gi·ªëng h·ªát v·ªõi file pause.js, ch·ªâ kh√°c h√†m <strong>setPaused()</strong> ch√∫ng ta truy·ªÅn v√†o gi√° tr·ªã false:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">setPaused</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">resume</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">resumes the currently paused song.</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">guild</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">client</span><span class="p">.</span><span class="nx">guilds</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">author</span> <span class="o">=</span> <span class="k">await</span> <span class="nx">guild</span><span class="p">.</span><span class="nx">members</span><span class="p">.</span><span class="nx">fetch</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">author</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">author</span><span class="p">.</span><span class="nx">voice</span><span class="p">.</span><span class="nx">channelId</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="dl">'</span><span class="s1">you are not in a voice channel.</span><span class="dl">'</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | there is no music playing in this server.</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">setPaused</span><span class="p">(</span><span class="kc">false</span><span class="p">);</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span>
                <span class="nx">y</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">‚ñ∂ | resumed.</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | failed to resume.</span><span class="dl">'</span>
            <span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>C√°c b·∫°n nh·ªõ k·∫øt n·ªëi file n√†y v√†o <strong>handler.js</strong> nha:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">command</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">resume</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Resume</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../commands/resume</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">Resume</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="skipjs">skip.js</h2>

<p>Ch·ª©c nƒÉng b·ªè qua b√†i nh·∫°c hi·ªán t·∫°i l√† kh√¥ng th·ªÉ thi·∫øu v·ªõi m·ªôt ·ª©ng d·ª•ng ch∆°i nh·∫°c. C√°c b·∫°n h√£y t·∫°o file v·ªõi t√™n <strong>skip.js</strong> trong folder commands:</p>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 10.png" alt="Untitled 10.png" /></p>

<p>Ti·∫øp theo ch√∫ng ta s·∫Ω l·∫•y th√¥ng tin v·ªÅ queue hi·ªán t·∫°i:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>

<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
        <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | no music is playing in this server</span><span class="dl">'</span><span class="p">,</span>
        <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ch√∫ng ta s·ª≠ d·ª•ng h√†m <strong>skip()</strong> ƒë·ªÉ b·ªè qua b√†i nh·∫°c, sau ƒë√≥ th√¥ng b√°o v√†o server:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">currentTrack</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">nowPlaying</span><span class="p">().</span><span class="nx">title</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">success</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">skip</span><span class="p">();</span>
<span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
    <span class="na">content</span><span class="p">:</span> <span class="nx">success</span>
        <span class="p">?</span> <span class="s2">`‚è≠ | skipped **</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">}</span><span class="s2">**`</span>
        <span class="p">:</span> <span class="s2">`:x: | failed to skip track`</span>
<span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">skip</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">skip a song.</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | no music is playing in this server</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="kd">const</span> <span class="nx">currentTrack</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">nowPlaying</span><span class="p">().</span><span class="nx">title</span><span class="p">;</span>
        <span class="kd">const</span> <span class="nx">success</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">skip</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
            <span class="na">content</span><span class="p">:</span> <span class="nx">success</span>
                <span class="p">?</span> <span class="s2">`‚è≠ | skipped **</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">}</span><span class="s2">**`</span>
                <span class="p">:</span> <span class="s2">`:x: | failed to skip track`</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Cu·ªëi c√πng th√¨ k·∫øt n·ªëi file n√†y v√†o <strong>handler.js</strong>:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">command</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">skip</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Skip</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../commands/skip</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">Skip</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="backjs">back.js</h2>

<p>Ch√∫ng ta s·∫Ω l·∫≠p tr√¨nh ch·ª©c nƒÉng quay l·∫°i v·ªÅ b√†i nh·∫°c tr∆∞·ªõc ƒë√≥. C√°c b·∫°n h√£y t·∫°o file <strong>back.js</strong> trong folder <strong>commands</strong>, sau ƒë√≥ l·∫•y th√¥ng tin v·ªÅ queue ƒëang ch·∫°y:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">MessageEmbed</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord.js</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">back</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plays the previous track.</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | no music is playing in this server</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau ƒë√≥ ch√∫ng ta ƒë∆°n gi·∫£n ch·ªâ c·∫ßn s·ª≠ d·ª•ng h√†m <strong>back()</strong> ƒë·ªÉ quay l·∫°i b√†i tr∆∞·ªõc, sau ƒë√≥ th√¥ng b√°o l√™n v√†o k√™nh chat:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">queue</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
    <span class="kd">const</span> <span class="nx">currentTrack</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">nowPlaying</span><span class="p">();</span>

    <span class="kd">const</span> <span class="nx">playEmbed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageEmbed</span><span class="p">()</span>
        <span class="p">.</span><span class="nx">setColor</span><span class="p">(</span><span class="s2">`RANDOM`</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="s2">`üé∂ | now playing`</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">setDescription</span><span class="p">(</span><span class="s2">`[</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">](</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="s2">)`</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">setThumbnail</span><span class="p">(</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">thumbnail</span><span class="p">);</span>

    <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="nx">playEmbed</span> <span class="p">});</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">MessageEmbed</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord.js</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">back</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">plays the previous track.</span><span class="dl">'</span><span class="p">,</span>

    <span class="c1">// fuk</span>
    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | no music is playing in this server</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">queue</span><span class="p">.</span><span class="nx">back</span><span class="p">();</span>
            <span class="kd">const</span> <span class="nx">currentTrack</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">nowPlaying</span><span class="p">();</span>

            <span class="kd">const</span> <span class="nx">playEmbed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageEmbed</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">setColor</span><span class="p">(</span><span class="s2">`RANDOM`</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="s2">`üé∂ | now playing`</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">setDescription</span><span class="p">(</span><span class="s2">`[</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">](</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="s2">)`</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">setThumbnail</span><span class="p">(</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">thumbnail</span><span class="p">);</span>

            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="nx">playEmbed</span> <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau ƒë√≥ quay l·∫°i file <strong>handler.js</strong> v√† k·∫øt n·ªëi file n√†y:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">command</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">back</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Back</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../commands/back</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">Back</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="stopjs">stop.js</h2>

<p>L·ªánh n√†y c√≥ ch·ª©c nƒÉng d·ª´ng h·∫≥n ch∆°i nh·∫°c v√† x√≥a danh s√°ch c√°c b√†i nh·∫°c ƒë√£ ƒëƒÉng k√Ω. Nh·ªù s·ª± ti·ªán l·ª£i c·ªßa module <strong>discord-player</strong>, ch√∫ng ta c√≥ th·ªÉ ƒë∆°n gi·∫£n l√†m vi·ªác n√†y v·ªõi h√†m <strong>destroy()</strong>.</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre></td><td class="rouge-code"><pre><span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">stop</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">stop your music and destroy your queue.</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span> <span class="o">||</span> <span class="o">!</span><span class="nx">queue</span><span class="p">.</span><span class="nx">playing</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | no music is being played.</span><span class="dl">'</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>

        <span class="nx">queue</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
        <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
            <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">üõë | successfully stopped music.</span><span class="dl">'</span><span class="p">,</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>H√£y nh·ªõ k·∫øt n·ªëi v·ªõi file <strong>handler.js</strong> nha:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">command</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">stop</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">Stop</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../commands/stop</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">Stop</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<h2 id="nowplayingjs">nowplaying.js</h2>

<p>T√≠nh nƒÉng l·∫•y th√¥ng tin c·ªßa b√†i nh·∫°c hi·ªán t·∫°i ƒëang ch∆°i c≈©ng r·∫•t h·ªØu √≠ch. ƒê·ªÉ l·∫≠p tr√¨nh ƒë∆∞·ª£c t√≠nh nƒÉng n√†y, c√°c b·∫°n h√£y t·∫°o file <strong>nowplaying.js</strong> trong th∆∞ m·ª•c <strong>commands</strong> v√† l·∫•y th√¥ng tin v·ªÅ queue hi·ªán t·∫°i:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">MessageEmbed</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord.js</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">nowplaying</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">displays currently playing song.</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | no music is playing in this server</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau ƒë√≥ ch√∫ng ta l·∫•y th√¥ng tin v·ªÅ b√†i nh·∫°c ƒëang ƒë∆∞·ª£c ch·∫°y b·∫±ng h√†m <strong>nowPlaying()</strong>:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">currentTrack</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">nowPlaying</span><span class="p">();</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau ƒë√≥ ch√∫ng ta cho Bot th√¥ng b√°o l√™n server b·∫±ng m·ªôt <a href="https://discordjs.guide/popular-topics/embeds.html#embed-preview">Embed Message</a> th·∫≠t ƒë·∫πp:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">npEmbed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageEmbed</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">setColor</span><span class="p">(</span><span class="s2">`RANDOM`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="s2">`üé∂ | now playing`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setDescription</span><span class="p">(</span><span class="s2">`[</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">](</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="s2">)`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setThumbnail</span><span class="p">(</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">thumbnail</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">addFields</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">uploader</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">value</span><span class="p">:</span> <span class="nx">currentTrack</span><span class="p">.</span><span class="nx">author</span><span class="p">,</span>
            <span class="na">inline</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">duration</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">value</span><span class="p">:</span> <span class="nx">currentTrack</span><span class="p">.</span><span class="nx">duration</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">s</span><span class="dl">"</span><span class="p">,</span>
            <span class="na">inline</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="cm">/*{
            name: 'requested by',
            value: currentTrack.requestedBy.username,
            inline: true,
        },*/</span>
        <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">views</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">value</span><span class="p">:</span> <span class="nx">currentTrack</span><span class="p">.</span><span class="nx">views</span><span class="p">.</span><span class="nx">toString</span><span class="p">(),</span>
            <span class="na">inline</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
        <span class="p">},</span>
        <span class="p">{</span>
            <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">progress bar</span><span class="dl">'</span><span class="p">,</span>
            <span class="na">value</span><span class="p">:</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">createProgressBar</span><span class="p">({</span> <span class="na">timecodes</span><span class="p">:</span> <span class="kc">true</span> <span class="p">}),</span>
        <span class="p">},</span>
    <span class="p">);</span>

<span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="p">[</span><span class="nx">npEmbed</span><span class="p">]</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>H√£y nh·ªõ k·∫øt n·ªëi file n√†y v·ªõi <strong>handler.js</strong> nha:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(</span><span class="nx">command</span> <span class="o">==</span> <span class="dl">'</span><span class="s1">nowplaying</span><span class="dl">'</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">const</span> <span class="nx">NowPlaying</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../commands/nowplaying</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">NowPlaying</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">);</span>
    <span class="k">return</span><span class="p">;</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 11.png" alt="Untitled 11.png" /></p>

<h2 id="queuejs">queue.js</h2>

<p>Ch·ª©c nƒÉng cu·ªëi c√πng v√† c≈©ng r·∫•t h·ªØu d·ª•ng, ƒë√≥ l√† th√¥ng b√°o v·ªÅ nh·ªØng b√†i nh·∫°c ƒëang ch·ªù trong queue. ƒê·∫ßu ti√™n, ch√∫ng ta t·∫°o file <strong>queue.js</strong> trong th∆∞ m·ª•c <strong>commands</strong>, sau ƒë√≥ l·∫•y th√¥ng tin v·ªÅ queue hi·ªán t·∫°i:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="p">{</span> <span class="nx">MessageEmbed</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">discord.js</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
    <span class="na">name</span><span class="p">:</span> <span class="dl">'</span><span class="s1">queue</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">description</span><span class="p">:</span> <span class="dl">'</span><span class="s1">displays current queue</span><span class="dl">'</span><span class="p">,</span>

    <span class="k">async</span> <span class="nx">execute</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="nx">client</span><span class="p">,</span> <span class="nx">player</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">const</span> <span class="nx">queue</span> <span class="o">=</span> <span class="nx">player</span><span class="p">.</span><span class="nx">getQueue</span><span class="p">(</span><span class="nx">message</span><span class="p">.</span><span class="nx">guildId</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">queue</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span>
                <span class="na">content</span><span class="p">:</span> <span class="dl">'</span><span class="s1">:x: | no music is playing in this server</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">ephemeral</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
            <span class="p">});</span>
        <span class="p">}</span>
		<span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Sau ƒë√≥ ch√∫ng ta l·∫•y danh s√°ch c√°c b√†i trong queue n√†y:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">currentTrack</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">current</span><span class="p">;</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p>Ch√∫ng ta l·∫•y 10 b√†i ƒë·∫ßu ti√™n trong queue ƒë·ªÉ hi·ªÉn th·ªã, sau ƒë√≥ th√¥ng b√°o l√™n server b·∫±ng Embed Message:</p>

<div class="language-jsx highlighter-rouge"><div class="highlight"><pre class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="kd">const</span> <span class="nx">tracks</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">tracks</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">10</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">m</span><span class="p">,</span> <span class="nx">i</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="s2">`</span><span class="p">${</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">}</span><span class="s2">. **</span><span class="p">${</span><span class="nx">m</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">** ([link](</span><span class="p">${</span><span class="nx">m</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="s2">))`</span><span class="p">;</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">progressBar</span> <span class="o">=</span> <span class="nx">queue</span><span class="p">.</span><span class="nx">createProgressBar</span><span class="p">({</span> <span class="na">timecodes</span><span class="p">:</span> <span class="kc">true</span> <span class="p">});</span>

<span class="kd">const</span> <span class="nx">queueEmbed</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">MessageEmbed</span><span class="p">()</span>
    <span class="p">.</span><span class="nx">setColor</span><span class="p">(</span><span class="s2">`RANDOM`</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setTitle</span><span class="p">(</span><span class="dl">'</span><span class="s1">üé∂ | current queue</span><span class="dl">'</span><span class="p">)</span>
    <span class="p">.</span><span class="nx">setDescription</span><span class="p">(</span>
        <span class="s2">`**__now playing__ - [</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">title</span><span class="p">}</span><span class="s2">](</span><span class="p">${</span><span class="nx">currentTrack</span><span class="p">.</span><span class="nx">url</span><span class="p">}</span><span class="s2">)**\n
        </span><span class="p">${</span><span class="nx">progressBar</span><span class="p">}</span><span class="s2">\n
        </span><span class="p">${</span><span class="nx">tracks</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">)}${</span>
            <span class="nx">queue</span><span class="p">.</span><span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span>
                <span class="p">?</span> <span class="s2">`\n...</span><span class="p">${</span>
                    <span class="nx">queue</span><span class="p">.</span><span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="nx">tracks</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">1</span>
                        <span class="p">?</span> <span class="s2">`{queue.tracks.length - tracks.length} more track`</span>
                        <span class="p">:</span> <span class="s2">`{queue.tracks.length - tracks.length} more tracks`</span>
                    <span class="p">}</span><span class="s2">`</span>
                <span class="p">:</span> <span class="dl">""</span>
        <span class="p">}</span><span class="s2">`</span>
    <span class="p">);</span>

<span class="k">return</span> <span class="k">await</span> <span class="nx">message</span><span class="p">.</span><span class="nx">channel</span><span class="p">.</span><span class="nx">send</span><span class="p">({</span> <span class="na">embeds</span><span class="p">:</span> <span class="p">[</span><span class="nx">queueEmbed</span><span class="p">]</span> <span class="p">});</span>
</pre></td></tr></tbody></table></code></pre></div></div>

<p style="text-align: center;"><img src="/assets/images/posts/2022-05-06-discord-music-bot-3/Untitled 12.png" alt="Untitled 12.png" /></p>

<h2 id="t·ªïng-k·∫øt">T·ªïng k·∫øt</h2>

<p>N·∫øu c√°c b·∫°n theo m√¨nh ƒë·∫øn ƒë√¢y, ch√∫c m·ª´ng b·∫°n ƒë√£ t·ª± tay l·∫≠p tr√¨nh ra m·ªôt con bot si√™u vjp. Tr√™n ƒë√¢y, UCC ƒë√£ h∆∞·ªõng d·∫´n 8 ch·ª©c nƒÉng c∆° b·∫£n nh·∫•t c·ªßa m·ªôt con Bot Discord ch∆°i nh·∫°c. C√°c b·∫°n ho√†n to√†n c√≥ th·ªÉ th·ªèa th√≠ch s√°ng t·∫°o th√™m nh·ªØng t√≠nh nƒÉng kh√°c cho Bot, th·∫≠m ch√≠ c√≥ th·ªÉ l√†m game v·ªõi n√≥. N·∫øu c√≥ b·∫•t k·ª≥ th·∫Øc m·∫Øc n√†o, h√£y ƒë·ª´ng ng·∫ßn ng·∫°i m√† nh·∫Øn tin cho ch√∫ng t·ªõ t·∫°i <a href="https://www.facebook.com/USTH.Coders.Club/">fanpage</a> nh√©!</p>

<p>Cu·ªëi c√πng, ch√∫ng m√¨nh g·ª≠i l·∫°i c√°c b·∫°n to√†n b·ªô m√£ ngu·ªìn c·ªßa con bot t·∫°i <a href="https://github.com/j1nxie/minccino">ƒë√¢y</a>.</p>

            </div>
            <script src="/assets/js/tocbtn.js"></script>
            <!-- Rating -->
            

            <!-- Post Date -->
            <p>
            <small>
                <span class="post-date"><time class="post-date" datetime="2022-05-06">06 May 2022</time></span>           
                
                </small>
            </p>

            <!-- Post Categories -->
            <div class="after-post-cats">
                <ul class="tags mb-4">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/categories#javascript">javascript</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Categories -->

            <!-- Post Tags -->
            <div class="after-post-tags">
                <ul class="tags">
                    
                    
                    <li>
                        <a class="smoothscroll" href="/tags#coding">#coding</a>
                    </li>
                    
                </ul>
            </div>
            <!-- End Tags -->

            <!-- Prev/Next -->
            <!-- <div class="row PageNavigation d-flex justify-content-between font-weight-bold">
            
            <a class="prev d-block col-md-6" href="//discord-music-bot-2/"> &laquo; [CODE MUSIC BOT FOR DISCORD] - Ph·∫ßn 2: M·ªôt s·ªë l·ªánh c∆° b·∫£n</a>
            
            
            <a class="next d-block col-md-6 text-lg-right" href="//GUI-vs-CLI/">So s√°nh GUI v√† CLI &raquo; </a>
            
            <div class="clearfix"></div>
            </div> -->
            <!-- End Categories -->

        </div>
        <!-- End Post -->

    </div>
</div>
<!-- End Article
================================================== -->

<!-- Begin Comments
================================================== -->
<script src="https://giscus.app/client.js"
        data-repo="USTH-Coders-Club/USTH-Coders-Club.github.io"
        data-repo-id="R_kgDOG_EjEA"
        data-category="Announcements"
        data-category-id="DIC_kwDOG_EjEM4CODbv"
        data-mapping="pathname"
        data-reactions-enabled="1"
        data-emit-metadata="0"
        data-input-position="bottom"
        data-theme="light"
        data-lang="en"
        crossorigin="anonymous"
        async>
</script>
<!--End Comments
================================================== -->

<!-- Review with LD-JSON, adapt it for your needs if you like, but make sure you test the generated HTML source code first: 
https://search.google.com/structured-data/testing-tool/u/0/
================================================== -->

</div>

                
            </div>

            <!-- Categories Jumbotron
================================================== -->
            <div class="jumbotron fortags">
                <div class="d-md-flex h-100">
                    <div class="col-md-4 transpdark align-self-center text-center h-100">
                        <div class="d-md-flex align-items-center justify-content-center h-100">
                            <h2 class="d-md-block align-self-center py-1 font-weight-light">
                                Explore <span class="d-none d-md-inline">‚Üí</span>
                            </h2>
                        </div>
                    </div>
                    <div class="col-md-8 p-5 align-self-center text-center">
                          
                        <a
                            class="mt-1 mb-1"
                            href="/categories#python"
                            >python (1)</a
                        >
                        
                        <a
                            class="mt-1 mb-1"
                            href="/categories#math"
                            >math (1)</a
                        >
                        
                        <a
                            class="mt-1 mb-1"
                            href="/categories#computer-science"
                            >computer science (1)</a
                        >
                        
                        <a
                            class="mt-1 mb-1"
                            href="/categories#skill"
                            >skill (2)</a
                        >
                        
                        <a
                            class="mt-1 mb-1"
                            href="/categories#javascript"
                            >javascript (3)</a
                        >
                        
                        <a
                            class="mt-1 mb-1"
                            href="/categories#Operating-Systems"
                            >Operating Systems (1)</a
                        >
                        
                        <a
                            class="mt-1 mb-1"
                            href="/categories#security"
                            >security (1)</a
                        >
                        
                        <a
                            class="mt-1 mb-1"
                            href="/categories#coding"
                            >coding (1)</a
                        >
                          
                    </div>
                </div>
            </div>

            <!-- Begin Footer
================================================== -->
            <footer class="footer">
                <div class="container">
                    <div class="row">
                        <div class="col-md-6 col-sm-6 text-center text-lg-left">
                            Copyright ¬© 2022 USTH Coders Club Blog
                        </div>
                    </div>
                </div>
            </footer>
            <!-- End Footer
================================================== -->
        </div>
        <!-- /.site-content -->

        <!-- Scripts
================================================== -->

        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
            integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
            crossorigin="anonymous"
        ></script>

        <script
            src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
            integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
            crossorigin="anonymous"
        ></script>

        <script src="/assets/js/mediumish.js"></script>

        

        <script src="/assets/js/ie10-viewport-bug-workaround.js"></script>
    </body>
</html>
